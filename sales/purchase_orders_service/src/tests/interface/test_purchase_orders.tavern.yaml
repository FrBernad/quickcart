---
test_name: Purchase orders

includes:
 - !include tavern_purchase_orders_variables.yaml

marks:
 - usefixtures:
     - test_client
     - test_database

stages:
  - name: Non-existing order should return 404
    request:
      url: "{purchase_orders_base_url:s}/4"
      method: GET
    response:
      status_code: 404

  - name: Create a new purchase order
    request:
      url: "{purchase_orders_base_url:s}/"
      method: POST
       json:
        comments: "Comentario"
        user_id: "1"
        products:
          - product_id: "1"
            product_price: 127.21
            product_quantity: 1
          - product_id: "2"
            product_price: 127.21
            product_quantity: 1
        total_price: 300
        payment_details:
          payment_method: "CREDIT_CARD"
          card_number: "123456789012345"
          expiration_year: 2022
          expiration_month: 3
          cvv: "123"
          card_type: "VISA"
    response:
      status_code: 201
      save:
        json:
          order_id: id

  # - name: Get the created order
  #   request:
  #     url: http://your-api-url/api/orders/{order_id}
  #     method: GET
  #   response:
  #     status_code: 200
  #     json:
  #       id: "{order_id}"
  #       comments: "Test order"
  #       user_id: 1
  #       total_price: 300